on:
  pull_request:
    branches:
      - main

env:
  test_sheet_id: ${{ secrets.test_sheet_id }}

jobs:
  run-tests:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - run: sudo apt update ; sudo apt-get install ruby-full build-essential zlib1g-dev ; echo '# Install Ruby Gems to ~/gems' >> ~/.bashrc ; echo 'export GEM_HOME="$HOME/gems"' >> ~/.bashrc ; echo 'export PATH="$HOME/gems/bin:$PATH"' >> ~/.bashrc ; source ~/.bashrc ;gem install jekyll bundler ; sudo apt install python3 python3-pip ; pip install xdotool
    - run: pip install -r tests/test_requirements.txt
    - run: jekyll serve -B -s site
    - name: Set up service_account_credentials.json
      run: |
        echo '${{ secrets.service_account_credentials }}' > service_account_credentials.json
    - run: python -m unittest discover -s ./tests/
